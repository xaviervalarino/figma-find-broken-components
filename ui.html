<div style="font-family: sans-serif">
  <div
    style="
      display: flex;
      padding: 8px;
      justify-content: space-between;
      align-items: center;
    "
  >
    <h4 style="margin: 0">Found on Current Page</h4>
    <button
      id="refresh"
      style="
        background: navy;
        font-weight: bold;
        color: white;
        border: 0;
        border-radius: 3px;
        padding: 8px;
      "
    >
      refresh
    </button>
  </div>
  <ul id="list" style="padding-left: 0; list-style-type: none"></ul>
</div>

<script>
  const list = document.getElementById("list");

  document.getElementById("refresh").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "refresh" } }, "*");
  };

  onmessage = (event) => {
    const { type, found } = event.data.pluginMessage;

    if (type === "selectionchange") {
      for (const li of list.children) {
        li.style.background = "";
      }
    }

    if (type === "found") {
      const listItems = found.map(([id, name]) => {
        const li = document.createElement("li");
        const div = document.createElement("div");
        const button = document.createElement("button");

        li.style = "padding: 8px; border-top: 1px solid rgba(10,10,10,0.1)";
        button.textContent = "Go to";
        button.onclick = () => {
          parent.postMessage(
            { pluginMessage: { type: "go-to-broken", id: id } },
            "*"
          );
          // super janky---this is so that the focus event doesn't undo this
          setTimeout(() => {
            li.style.background = "lightblue";
          }, 100);
        };
        div.textContent = name;
        div.style = "display: flex; justify-content: space-between";
        div.appendChild(button);
        li.appendChild(div);
        return li;
      });
      if (!listItems.length) listItems.push("ðŸŽ‰ No broken components");
      list.replaceChildren(...listItems);
    }
  };
</script>
