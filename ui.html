<div style="font-family: sans-serif">
  <h4>Found on Current Page</h4>
  <ul id="list" style="padding-left: 0"></ul>
</div>

<script>
  const list = document.getElementById("list")
  onmessage = (event) => {
    const { type, found } = event.data.pluginMessage;

    if (type === 'selectionchange') {
      for (const li of list.children) {
        li.style.background = ''
      }
    }

    if (type === "found") {
      const listItems = found.map(([id, name]) => {
        const li = document.createElement("li");
        const div = document.createElement("div");
        const button = document.createElement("button");

        li.style = "padding: 8px; border-bottom: 1px solid rgba(10,10,10,0.1)";
        button.textContent = "Go to";
        button.onclick = () => {
          parent.postMessage(
            { pluginMessage: { type: "go-to-broken", id: id } },
            "*"
          );
          // super janky---this is so that the focus event doesn't undo this
          setTimeout(() => {
            li.style.background = "lightblue";
          }, 100)
        };
        div.textContent = name;
        div.style = "display: flex; justify-content: space-between";
        div.appendChild(button);
        li.appendChild(div);
        return li;
      });
      if (!listItems.length) listItems.push("ðŸŽ‰ No broken components");
      list.replaceChildren(...listItems);
    }
  };
</script>
